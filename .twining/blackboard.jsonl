{"entry_type":"decision","summary":"Use blackboard pattern for agent coordination instead of pipeline/message-passing","detail":"Blackboard pattern lets agents self-select into work based on visible shared state. Broadcasting needs rather than routing messages avoids coupling agents to each other.","tags":["architecture"],"scope":"project","agent_id":"main","id":"01KHMSENMRZD2WJ1MGGCYJK9C1","timestamp":"2026-02-17T03:14:11.736Z"}
{"entry_type":"decision","summary":"All state stored as .jsonl and .json files in .twining/ directory — no external databases","detail":"File-native storage means jq-queryable, git-diffable, no setup. JSONL for append-only streams (blackboard), JSON for indexed records (decisions, graph).","tags":["architecture"],"scope":"src/storage/","agent_id":"main","id":"01KHMSETGKT6BWJBH094CR5QW1","timestamp":"2026-02-17T03:14:16.723Z"}
{"entry_type":"decision","summary":"Embeddings must be lazy-loaded and fall back gracefully to keyword search if ONNX/transformers fails","detail":"Key constraint: embedding system is enhancement, not requirement. Lazy loading defers heavy init. Fallback to keyword search (substring matching) ensures all query tools work regardless.","tags":["architecture"],"scope":"src/embeddings/","agent_id":"main","id":"01KHMSEXTX8D5WG0DX9ME4XX95","timestamp":"2026-02-17T03:14:20.125Z"}
{"entry_type":"decision","summary":"Use ULIDs for all entity IDs — temporally sortable, globally unique","detail":"ULIDs are timestamp-prefixed so they sort chronologically, are globally unique without coordination, and are more readable than UUIDs.","tags":["implementation"],"scope":"src/utils/ids.ts","agent_id":"main","id":"01KHMSF11372XHAK0CXAJQ3PHM","timestamp":"2026-02-17T03:14:23.395Z"}
{"entry_type":"warning","summary":"Potential conflict: new decision may conflict with 1 existing decision(s)","detail":"New decision \"Build bottom-up: utils → storage → engine → embeddings → tools → server\" conflicts with:\n- 01KHMSENMNZPHBFAV1P6V50RXA: \"Use blackboard pattern for agent coordination instead of pipeline/message-passing\"","tags":["architecture"],"scope":"project","agent_id":"main","id":"01KHMSF3TKGP1R61AA9SZZS77Q","timestamp":"2026-02-17T03:14:26.259Z"}
{"entry_type":"decision","summary":"Build bottom-up: utils → storage → engine → embeddings → tools → server","detail":"Each layer only depends on layers below it. Storage never calls engine, engine never calls tools. This makes testing straightforward — each layer can be tested in isolation with mocks of the layer below.","tags":["architecture"],"scope":"project","agent_id":"main","id":"01KHMSF3VZN3HYP8BD4G1CWCQ5","timestamp":"2026-02-17T03:14:26.303Z"}
{"entry_type":"decision","summary":"Decisions track commit hashes to link architectural choices to git history","detail":"Enables twining_why to answer 'why was this commit made?' and twining_commits to find decisions by commit hash. Bridges the gap between decision rationale and actual code changes.","tags":["implementation"],"scope":"src/engine/decisions.ts","agent_id":"main","id":"01KHMSF83PFEB43JZ7HMWGT585","timestamp":"2026-02-17T03:14:30.646Z"}
{"entry_type":"finding","summary":"v1.0 milestone complete — all 3 phases shipped (storage+engine, embeddings+context, graph+lifecycle)","detail":"Phase 1: Storage layer (file-store, blackboard-store, decision-store) + engine layer (blackboard, decisions). Phase 2: Embeddings (lazy ONNX + keyword fallback) + context assembly (assemble, summarize, what_changed). Phase 3: Knowledge graph (entities, relations, BFS traversal) + lifecycle tools (archive, reconsider, override, status).","tags":["milestone","v1.0","status"],"scope":"project","agent_id":"main","id":"01KHMSFFVYER2FTZW8RPJPGCVN","timestamp":"2026-02-17T03:14:38.591Z"}
{"entry_type":"finding","summary":"v1.1 milestone in progress — commit hash linking implemented (phase 4), further phases TBD","detail":"v1.1 'Integrations + Polish' milestone. Phase 4 (git commit linking) is complete: Decision model extended with commit_hashes field, linkCommit/getByCommitHash methods on DecisionEngine, twining_commits tool registered, twining_why enhanced to return commit_hashes.","tags":["milestone","v1.1","status"],"scope":"project","agent_id":"main","id":"01KHMSFKJ906YFEG10VHQ0CWBY","timestamp":"2026-02-17T03:14:42.378Z"}
{"entry_type":"finding","summary":"22 MCP tools exposed: 4 blackboard, 4 decision, 3 context, 4 graph, 4 lifecycle, plus twining_commits","detail":"Blackboard: post, read, query, recent. Decision: decide, why, trace, commits. Context: assemble, summarize, what_changed. Graph: add_entity, add_relation, neighbors, graph_query. Lifecycle: reconsider, override, archive, status.","tags":["tools","api-surface"],"scope":"src/tools/","agent_id":"main","id":"01KHMSFPNQYZBK592NX79MK12R","timestamp":"2026-02-17T03:14:45.559Z"}
{"entry_type":"finding","summary":"Layered architecture: utils → storage → engine → embeddings → tools → server (strict dependency direction)","detail":"Each layer only depends downward. Storage uses file-store for all I/O. Engine orchestrates storage + optional embeddings. Tools are thin wrappers that validate input and call engine methods. Server wires everything together via createServer().","tags":["architecture","layers"],"scope":"src/","agent_id":"main","id":"01KHMSFRZ42E9A2X0WTM3HY96C","timestamp":"2026-02-17T03:14:47.908Z"}
{"entry_type":"finding","summary":"Embedder uses @huggingface/transformers (replaced onnxruntime-node) with all-MiniLM-L6-v2 model","detail":"Design spec mentions onnxruntime-node but implementation uses @huggingface/transformers ^3.8.1. Embedder class is a singleton with lazy init. Falls back to keyword-based search (substring matching on summary+detail+tags) when transformers pipeline fails to load.","tags":["embeddings","dependency"],"scope":"src/embeddings/","agent_id":"main","id":"01KHMSFW4C40C3Y72ESDG5N54E","timestamp":"2026-02-17T03:14:51.148Z"}
{"entry_type":"finding","summary":"File-store uses proper-lockfile for advisory locking on JSON writes — prevents corruption from concurrent agents","detail":"LOCK_OPTIONS: retries with backoff, stale lock detection. All JSON read/write and JSONL append operations go through file-store functions. JSONL append is atomic (single write call).","tags":["storage","concurrency"],"scope":"src/storage/file-store.ts","agent_id":"main","id":"01KHMSFZ6SP8RJ4674FXWB2CTE","timestamp":"2026-02-17T03:14:54.297Z"}
{"entry_type":"finding","summary":"Phase 5 complete: PlanningBridge read/write + Serena docs — 262 tests passing, 5/5 requirements met","detail":"05-01: PlanningBridge reads .planning/STATE.md and REQUIREMENTS.md, integrated into assemble() and summarize(). Planning context scored alongside blackboard/decisions. 05-02: decide() syncs summaries to STATE.md Decisions section. CLAUDE.md documents Serena enrichment workflow. 7/7 must-haves verified. Commits: 726e43e, 041d7f5, d1628d1, 5129bc0.","tags":["phase-5","milestone","v1.1"],"scope":"project","agent_id":"main","id":"01KHMV0A437X10W43V90VYBCB9","timestamp":"2026-02-17T03:41:18.339Z"}
{"entry_type":"decision","summary":"PlanningBridge as separate engine module, not inline in ContextAssembler","detail":"Keeps .planning/ parsing isolated, testable, and reusable. ContextAssembler receives PlanningBridge via constructor injection.","tags":["architecture"],"scope":"src/engine/planning-bridge.ts","agent_id":"main","id":"01KHMV0F56CPNPX1NAH2R3HDBC","timestamp":"2026-02-17T03:41:23.494Z"}
{"entry_type":"warning","summary":"Potential conflict: new decision may conflict with 1 existing decision(s)","detail":"New decision \"Direct fs calls in DecisionEngine for STATE.md sync — deliberate exception to storage-layer convention\" conflicts with:\n- 01KHMSF83J0CN3599E4681ER6A: \"Decisions track commit hashes to link architectural choices to git history\"","tags":["implementation"],"scope":"src/engine/decisions.ts","agent_id":"main","id":"01KHMV0JDC0GN0YWB7FNWXRVM9","timestamp":"2026-02-17T03:41:26.828Z"}
{"entry_type":"decision","summary":"Direct fs calls in DecisionEngine for STATE.md sync — deliberate exception to storage-layer convention","detail":"file-store.ts is for .twining/ data with advisory locking. STATE.md is external — using direct fs is cleaner than extending storage abstractions for a single external file.","tags":["implementation"],"scope":"src/engine/decisions.ts","agent_id":"main","id":"01KHMV0JES4F0ESX3JCYATS6XH","timestamp":"2026-02-17T03:41:26.873Z"}
{"entry_type":"answer","summary":"Dismissed: build order vs coordination pattern are orthogonal — no real conflict","detail":"Build bottom-up order (utils → storage → engine → etc.) describes implementation sequence. Blackboard pattern describes runtime coordination architecture. These are independent concerns with no conflict.","tags":["architecture"],"scope":"project","relates_to":["01KHMSF3TKGP1R61AA9SZZS77Q"],"agent_id":"main","id":"01KHN3DVJRQ91FRWXQSBXPZYVG","timestamp":"2026-02-17T06:08:30.812Z"}
{"entry_type":"answer","summary":"Dismissed: STATE.md fs exception and commit tracking are orthogonal — no real conflict","detail":"Direct fs calls for STATE.md sync is a deliberate, documented exception to the storage-layer convention. Commit hash tracking in decisions is a separate feature for git traceability. These do not conflict.","tags":["implementation"],"scope":"src/engine/decisions.ts","relates_to":["01KHMV0JDC0GN0YWB7FNWXRVM9"],"agent_id":"main","id":"01KHN3DXSXMV7TQMS8AQBM26PK","timestamp":"2026-02-17T06:08:33.085Z"}
{"entry_type":"decision","summary":"Override: Direct fs calls in DecisionEngine for STATE.md sync — deliberate exception to storage-layer convention -- overridden by human","detail":"False-positive conflict detection — STATE.md fs exception and commit tracking are orthogonal. Restoring to active.","tags":["implementation"],"scope":"src/engine/decisions.ts","agent_id":"human","id":"01KHN3H7F40GCQCNCZWGH38F6H","timestamp":"2026-02-17T06:10:21.285Z"}
{"entry_type":"warning","summary":"Potential conflict: new decision may conflict with 1 existing decision(s)","detail":"New decision \"Direct fs calls in DecisionEngine for STATE.md sync — deliberate exception to storage-layer convention\" conflicts with:\n- 01KHMSF83J0CN3599E4681ER6A: \"Decisions track commit hashes to link architectural choices to git history\"","tags":["implementation"],"scope":"src/engine/decisions.ts","agent_id":"human","id":"01KHN3H7GKGM5JHA353RYBKV03","timestamp":"2026-02-17T06:10:21.331Z"}
{"entry_type":"decision","summary":"Direct fs calls in DecisionEngine for STATE.md sync — deliberate exception to storage-layer convention","detail":"False-positive conflict detection — STATE.md fs exception and commit tracking are orthogonal. Restoring to active.","tags":["implementation"],"scope":"src/engine/decisions.ts","agent_id":"human","id":"01KHN3H7H3A9G78WM2XYT6F3ZK","timestamp":"2026-02-17T06:10:21.347Z"}
{"entry_type":"decision","summary":"Override: Build bottom-up: utils → storage → engine → embeddings → tools → server -- overridden by human","detail":"False-positive conflict detection — build order and coordination pattern are orthogonal. Restoring to active.","tags":["architecture"],"scope":"project","agent_id":"human","id":"01KHN3H8F5BE2VZFRQB9SWFDZ1","timestamp":"2026-02-17T06:10:22.309Z"}
{"entry_type":"warning","summary":"Potential conflict: new decision may conflict with 1 existing decision(s)","detail":"New decision \"Build bottom-up: utils → storage → engine → embeddings → tools → server\" conflicts with:\n- 01KHMSENMNZPHBFAV1P6V50RXA: \"Use blackboard pattern for agent coordination instead of pipeline/message-passing\"","tags":["architecture"],"scope":"project","agent_id":"human","id":"01KHN3H8G0EEHCKY22EEZD16XZ","timestamp":"2026-02-17T06:10:22.336Z"}
{"entry_type":"decision","summary":"Build bottom-up: utils → storage → engine → embeddings → tools → server","detail":"False-positive conflict detection — build order and coordination pattern are orthogonal. Restoring to active.","tags":["architecture"],"scope":"project","agent_id":"human","id":"01KHN3H8GQZS4P6RM188029CQ2","timestamp":"2026-02-17T06:10:22.359Z"}
{"entry_type":"finding","summary":"v1.2 milestone scope: web dashboard with stats, search+filter, decision timeline, graph viz","detail":"User wants a Serena-style embedded web dashboard for Twining. Scope: (1) operational stats — tool usage counts, state volumes; (2) search + filter — text search across blackboard/decisions/graph with faceted filtering; (3) decision timeline — visual timeline showing decision lifecycle; (4) knowledge graph visualization — interactive entity+relation graph. Architecture: embedded HTTP server in MCP process, vanilla HTML/JS frontend, polling-based updates, minimal dependencies.","tags":["dashboard","v1.2","milestone"],"scope":"project","agent_id":"main","id":"01KHN4N0NZTN77WDK5NK74BFYD","timestamp":"2026-02-17T06:29:53.984Z"}
{"entry_type":"warning","summary":"Potential conflict: new decision may conflict with 1 existing decision(s)","detail":"New decision \"Embedded HTTP dashboard using native Node.js http module, vanilla HTML/JS, cytoscape.js for graph, vis-timeline for timeline\" conflicts with:\n- 01KHMSENMNZPHBFAV1P6V50RXA: \"Use blackboard pattern for agent coordination instead of pipeline/message-passing\"","tags":["architecture"],"scope":"project","agent_id":"main","id":"01KHN63362WZAAJZEZFWN0R6DG","timestamp":"2026-02-17T06:55:03.874Z"}
{"entry_type":"decision","summary":"Embedded HTTP dashboard using native Node.js http module, vanilla HTML/JS, cytoscape.js for graph, vis-timeline for timeline","detail":"Serena MCP pattern proven: in-process HTTP server, vanilla frontend, polling updates. Native http module avoids Express dependency. Cytoscape.js (109KB) and vis-timeline (186KB) are mature, zero-framework graph/timeline libraries. No build step required for frontend.","tags":["architecture"],"scope":"project","agent_id":"main","id":"01KHN633BYD9B8JJYP6CHWQKFJ","timestamp":"2026-02-17T06:55:04.062Z"}
{"entry_type":"status","summary":"Milestone v1.2 Web Dashboard shipped and archived — 4 phases, 10 plans, 26/26 requirements, 312 tests, tagged v1.2","detail":"v1.2 milestone complete. Archived to .planning/milestones/ (roadmap, requirements, audit, phase dirs). PROJECT.md evolved with validated requirements. ROADMAP.md reorganized. Git tag v1.2 pushed to origin.","tags":["milestone","v1.2","shipped"],"scope":"project","agent_id":"main","id":"01KHP3RJ7CBJSYPJZH2KGNKBA2","timestamp":"2026-02-17T15:33:36.111Z"}
{"entry_type":"status","summary":"Starting architecture review triage — evaluating TWINING_ARCH_REVIEW.md findings against codebase","detail":"","tags":["review","architecture","triage"],"scope":"project","agent_id":"main","id":"01KHQ0WB7A9E66C4B7Z1HEV8D6","timestamp":"2026-02-18T00:02:28.737Z"}
{"entry_type":"warning","summary":"Potential conflict: new decision may conflict with 1 existing decision(s)","detail":"New decision \"Triage of TWINING_ARCH_REVIEW.md — 7 valid gaps, 3 invalid/already-addressed, 3 partial\" conflicts with:\n- 01KHMSENMNZPHBFAV1P6V50RXA: \"Use blackboard pattern for agent coordination instead of pipeline/message-passing\"","tags":["architecture"],"scope":"project","agent_id":"main","id":"01KHQ0ZRHAXNYD5D0M2Y8C5AMX","timestamp":"2026-02-18T00:04:20.650Z"}
{"entry_type":"decision","summary":"Triage of TWINING_ARCH_REVIEW.md — 7 valid gaps, 3 invalid/already-addressed, 3 partial","detail":"Findings validated by reading actual implementation code via Serena. Scope-expansion items (divergences 5-6) are invalid because they were intentional milestone additions. Dashboard opt-out (CQ7) is partially invalid since env-var controls already exist. Pending-hooks (divergence 3) was explicitly deferred in project planning. The remaining 7 findings are confirmed real gaps.","tags":["architecture"],"scope":"project","agent_id":"main","id":"01KHQ0ZS2EH7PSH42BBHD5MQ1H","timestamp":"2026-02-18T00:04:21.198Z"}
{"entry_type":"artifact","summary":"Gap closure plan written to .planning/GAP_CLOSURE_PLAN.md — 9 valid findings across 5 priority tiers","detail":"P1: decision file locking + blackboard ordering. P2: reject decision posts + auto-graph in decide. P3: context assembly dedup. P4: expose coordination tools + version fix + doc embedding choice. P5: CLAUDE.md checklist.","tags":["review","plan","architecture"],"scope":"project","agent_id":"main","id":"01KHQ11WY1ZQJZX7AEKZYAB8H6","timestamp":"2026-02-18T00:05:30.695Z"}
{"entry_type":"decision","summary":"Expose delegation and handoff as MCP tools rather than removing dead CoordinationEngine code","detail":"Code is already written, tested, and the engine is constructed at startup. Exposing it completes the coordination feature set and eliminates the dead-code smell. Removing would waste existing work.","tags":["architecture"],"scope":"src/tools/coordination-tools.ts","agent_id":"main","id":"01KHQ18BXX0VM305GRT44VTPV7","timestamp":"2026-02-18T00:09:02.653Z"}
{"entry_type":"status","summary":"Gap closure complete — all 9 valid findings addressed, 444/444 tests passing","detail":"P1: decision file locking + blackboard ordering. P2: decision rejection in post + graph auto-population in decide. P3: context assembly deduplication (3x→1x blackboard, 2x→1x index). P4: 4 new coordination MCP tools + version sync + embedding docs. Tests updated for behavior changes.","tags":["review","complete","architecture"],"scope":"project","agent_id":"main","id":"01KHQ1SS1FB7YE5342MB1XXGB9","timestamp":"2026-02-18T00:18:33.158Z"}
{"entry_type":"status","summary":"P5 complete — comprehensive Twining integration guide added to CLAUDE.md, README updated with new coordination tools","detail":"CLAUDE.md now covers: setup, core workflow (assemble-before/decide-after), all 27 tools with usage guidance, entry type taxonomy, decision confidence/domain conventions, scope conventions, multi-agent patterns (delegation, handoff, context window handoff), dashboard config, and anti-patterns. README updated with 4 new coordination tools.","tags":["documentation","P5","complete"],"scope":"project","agent_id":"main","id":"01KHQ23MPNM1TEX43SSQENJNEX","timestamp":"2026-02-18T00:23:56.377Z"}
